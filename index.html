<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Stock Event Planner - MVP</title>
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <style>
        :root { --primary: #2962ff; --success: #00c853; --bg: #f8f9fa; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 20px; }
        .container { max-width: 1000px; margin: auto; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); }
        .grid { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-top: 20px; }
        #chart { height: 450px; width: 100%; border: 1px solid #eee; border-radius: 8px; }
        .panel { padding: 15px; border: 1px solid #eee; border-radius: 8px; background: #fff; }
        input, button { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        button { background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; }
        .event-list { margin-top: 15px; max-height: 200px; overflow-y: auto; font-size: 13px; }
        .event-item { padding: 8px; border-bottom: 1px solid #eee; }
    </style>
</head>
<body>

<div class="container">
    <h2 style="margin-top:0">ðŸ“ˆ Stock Event Planner</h2>
    
    <div style="display:flex; gap:10px;">
        <input type="text" id="symbol" value="IBM" style="width:150px">
        <button onclick="loadStock()" style="width:150px">Load Ticker</button>
    </div>

    <div class="grid">
        <div id="chart"></div>
        
        <div class="panel">
            <h4>Add News Event</h4>
            <input type="text" id="newsLink" placeholder="Paste News Link (URL)">
            <input type="date" id="eventDate">
            <input type="text" id="eventTitle" placeholder="News Title/Summary">
            <button onclick="plotAndSave()" style="background:var(--success)">Plot & Save Event</button>
            
            <div class="event-list" id="eventList">
                <strong>Saved Events:</strong>
                <div id="items"></div>
            </div>
            <button onclick="clearData()" style="background:#ff5252; font-size:10px; margin-top:10px;">Clear All Data</button>
        </div>
    </div>
</div>

<script>
    let chart, lineSeries, priceData = [];
    let savedEvents = JSON.parse(localStorage.getItem('myStockEvents')) || [];

    // 1. Initialize
    function init() {
        chart = LightweightCharts.createChart(document.getElementById('chart'), {
            layout: { textColor: '#444' },
            grid: { vertLines: { visible: false } },
        });
        lineSeries = chart.addLineSeries({ color: var(--primary) });
        loadStock();
        renderEventList();
    }

    // 2. Load Stock Data
    async function loadStock() {
        const symbol = document.getElementById('symbol').value;
        try {
            const res = await fetch(`https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=${symbol}&apikey=demo`);
            const data = await res.json();
            const daily = data["Time Series (Daily)"];
            priceData = Object.keys(daily).map(d => ({time: d, value: parseFloat(daily[d]["4. close"])})).sort((a,b) => a.time.localeCompare(b.time));
            lineSeries.setData(priceData);
            refreshMarkers();
        } catch(e) { alert("API Limit reached (IBM works with demo key)"); }
    }

    // 3. Plot and Save to LocalStorage
    function plotAndSave() {
        const date = document.getElementById('eventDate').value;
        const title = document.getElementById('eventTitle').value;
        if(!date || !title) return alert("Date and Title required");

        const newEvent = { date, title };
        savedEvents.push(newEvent);
        localStorage.setItem('myStockEvents', JSON.stringify(savedEvents));
        
        refreshMarkers();
        renderEventList();
    }

    function refreshMarkers() {
        const markers = savedEvents.map(ev => ({
            time: ev.date,
            position: 'aboveBar',
            color: '#f68410',
            shape: 'pin',
            text: ev.title
        }));
        lineSeries.setMarkers(markers);
    }

    function renderEventList() {
        const container = document.getElementById('items');
        container.innerHTML = savedEvents.map(ev => `
            <div class="event-item"><b>${ev.date}</b>: ${ev.title}</div>
        `).join('');
    }

    function clearData() {
        localStorage.removeItem('myStockEvents');
        savedEvents = [];
        refreshMarkers();
        renderEventList();
    }

    init();
</script>
</body>
</html>
